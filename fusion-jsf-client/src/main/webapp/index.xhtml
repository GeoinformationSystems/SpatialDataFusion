<?xml version="1.0" encoding="ISO-8859-1" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core">
<h:head>
	<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" />
	<title>Fusion Client</title>
	<link rel="stylesheet" href="http://openlayers.org/en/v3.1.1/css/ol.css" type="text/css" />
	<h:outputStylesheet library="css" name="styles.css" />
</h:head>
<h:body>

<div id="header" class="content ui-state-active">
	<div id="header_text">Fusion Client</div>
	<div id="status"><p:ajaxStatus>  
	    <f:facet name="start">  
	        <p:graphicImage value="resources/images/ajax-loader.png" />  
	    </f:facet>						      
	    <f:facet name="complete">  
	        <h:outputText value="" />  
	    </f:facet>
	</p:ajaxStatus></div>
</div>
	
<div id="mainframe">
	<h:form id="form">
	<p:growl id="message" showDetail="true" />	
	
	<div class="content section ui-state-hover">Reference Data</div>	         		
   	<h:panelGrid columns="3" styleClass="content alignTop">
      	      
        <p:selectOneButton id="r_service" value="wfs">
		    <f:selectItem itemLabel="WFS" itemValue="wfs" />
		</p:selectOneButton>
		<p:inputText id="r_base" placeholder="Base URL" value="#{referenceWFS.baseURL}" styleClass="inputText urlInput"/>
		<p:commandButton title="retrieve capabilities from server" action="#{referenceWFS.initCapabilities}" update="r_typename r_srsname :form:message r_getFeatures" icon="ui-icon-circle-arrow-s" style="width:27px;height:27px;" />
		
		<h:outputText />
		<h:panelGroup>
			<h:panelGroup>
				<p:selectOneMenu id="r_typename" value="#{referenceWFS.typename}" style="width:300px;">
					<f:selectItem itemLabel="select typeName" itemValue="#{referenceWFS.typename}" />
				    <f:selectItems value="#{referenceWFS.supportedTypenames}" />
					<p:ajax update="r_getFeatures r_srsname" />
				</p:selectOneMenu>
				<p:selectOneMenu id="r_srsname" value="#{referenceWFS.SRSName}" style="width:300px;" disabled="#{referenceWFS.forceWGS84}">
					<f:selectItem itemLabel="select srsName" itemValue="#{referenceWFS.SRSName}" />
				    <f:selectItems value="#{referenceWFS.supportedSRS}" />
					<p:ajax update="r_getFeatures" />
				</p:selectOneMenu>	
			</h:panelGroup>
			<h:panelGroup style="float:right;margin-right:0px;">			
				<p:selectBooleanButton id="r_forceWGS84" value="#{referenceWFS.forceWGS84}" onLabel="WGS84" offLabel="WGS84">
					<p:ajax update="r_getFeatures r_srsname" />
				</p:selectBooleanButton>
			</h:panelGroup>
		</h:panelGroup>
		<p:commandButton id="r_getFeatures" disabled="#{referenceWFS.WFSBaseIsInvalid}" title="#{referenceWFS.getFeatureRequest}" onclick="f_initMapResource_r('#{referenceWFS.getFeatureRequest}','#{referenceWFS.SRSName}',#{referenceWFS.centerAsString},#{referenceWFS.extentAsString})" icon="ui-icon-check" style="width:27px;height:27px;" />
			
	</h:panelGrid>
	
	<h:panelGrid columns="1" style="width:100%">		
		<div id="map_r" class="map">
			<div id="map_r_info" class="info" />
			<div id="map_r_coord" class="coord" />
		</div>		
	</h:panelGrid>
            
	<div class="content section ui-state-hover">Target Data</div>
	<h:panelGrid columns="3" styleClass="content alignTop">
	        
        <p:selectOneButton id="t_service" value="wfs">
		    <f:selectItem itemLabel="WFS" itemValue="wfs" />
		</p:selectOneButton>
		<p:inputText id="t_base" placeholder="Base URL" value="#{targetWFS.baseURL}" styleClass="inputText urlInput"/>
		<p:commandButton title="retrieve capabilities from server" action="#{targetWFS.initCapabilities}" update="t_typename t_srsname :form:message t_getFeatures" icon="ui-icon-circle-arrow-s" style="width:27px;height:27px;" />
		
		<h:outputText />
		<h:panelGroup>
			<h:panelGroup>
				<p:selectOneMenu id="t_typename" value="#{targetWFS.typename}" style="width:300px">
					<f:selectItem itemLabel="select typeName" itemValue="#{targetWFS.typename}" />
				    <f:selectItems value="#{targetWFS.supportedTypenames}" />
					<p:ajax update="t_getFeatures t_srsname" />
				</p:selectOneMenu>
				<h:outputText />
				<p:selectOneMenu id="t_srsname" value="#{targetWFS.SRSName}" style="width:300px" disabled="#{targetWFS.forceWGS84}">
					<f:selectItem itemLabel="select srsName" itemValue="#{targetWFS.SRSName}" />
				    <f:selectItems value="#{targetWFS.supportedSRS}" />
					<p:ajax update="t_getFeatures" />
				</p:selectOneMenu>
			</h:panelGroup>
			<h:panelGroup style="float:right;margin-right:0px;">
				<p:selectBooleanButton id="t_forceWGS84" value="#{targetWFS.forceWGS84}" onLabel="WGS84" offLabel="WGS84">
					<p:ajax update="t_getFeatures t_srsname" />
				</p:selectBooleanButton>
			</h:panelGroup>
		</h:panelGroup>
		<p:commandButton id="t_getFeatures" disabled="#{targetWFS.WFSBaseIsInvalid}" title="#{targetWFS.getFeatureRequest}" onclick="f_initMapResource_t('#{targetWFS.getFeatureRequest}','#{targetWFS.SRSName}',#{targetWFS.centerAsString},#{targetWFS.extentAsString})" icon="ui-icon-check" style="width:27px;height:27px;" />
			
	</h:panelGrid>
	
	<h:panelGrid columns="1" style="width:100%">	
		<div id="map_t" class="map">
			<div id="map_t_info" class="info" />
			<div id="map_t_coord" class="coord" />
		</div>	
	</h:panelGrid>
	
	<div class="content section ui-state-hover">Stats</div>  
	
	<p:outputPanel rendered="true" styleClass="content">
		<div id="stats_rt" />
	</p:outputPanel>
	
	<div class="content section ui-state-hover">Dataset Fusion</div>
	
	<h:panelGrid id="p_wpsConnectors" columns="2" styleClass="content alignTop">
	
		<p:selectOneButton value="sparql">
			<f:selectItem itemLabel="SPARQL" itemValue="sparql" />
		</p:selectOneButton>
		<p:inputText value="#{fusekiConnector.fusekiURL}" placeholder="SPARQL Endpoint" styleClass="inputText urlInput" />
		
		<p:selectOneButton value="wps">
			<f:selectItem itemLabel="WPS" itemValue="wps" />
		</p:selectOneButton>
	    <c:forEach items="#{wpsConnector.handlers}" var="handler">
		    <h:panelGroup>
				<p:inputText value="#{handler.baseURL}" placeholder="Base URL" styleClass="inputText urlInput" />
				<p:commandButton title="Retrieve capabilities from server" action="#{handler.initCapabilities}" update="f_processes_#{handler.id} :form:message" icon="ui-icon-circle-arrow-s" />
				<p:commandButton title="Remove WPS" icon="ui-icon-minus" action="#{wpsConnector.removeWPSHandler(handler.id)}" update="p_validation p_wpsConnectors" disabled="#{wpsConnector.numberOfHandlers eq 1}" />
				<p:commandButton title="Add WPS" icon="ui-icon-plus" action="#{wpsConnector.addWPSHandler}" update="p_wpsConnectors" rendered="#{handler.id eq wpsConnector.lastId}" />
		    </h:panelGroup>
		    <h:outputText />
		    <p:selectManyCheckbox id="f_processes_#{handler.id}" layout="grid" value="#{handler.selectedProcesses}" valueChangeListener="#{handler.updateProcesses}" columns="1">
				<f:selectItems value="#{handler.processDescriptions4Display.entrySet()}" var="entry" itemLabel="#{entry.value}" itemValue="#{entry.key}" escape="false" />
				<f:ajax />
       		</p:selectManyCheckbox>
       		<h:outputText />
	    </c:forEach>
		
	</h:panelGrid>
    
	<h:panelGrid columns="1" styleClass="alignTop" style="padding-top:0px;width:100%;">
     	<h:panelGroup layout="block">
			<div id="plumb_processes" />
			<div id="plumb_desc" />
		</h:panelGroup>
		<h:panelGroup style="margin-left:50px;">
	     	<p:inputText id="p_literal" placeholder="value" styleClass="inputText" style="width:80px;" />
     		<p:commandButton id="p_addLiteral" title="addLiteral" onclick="f_addLiteral();" value="add literal" icon="ui-icon-plus" />
     		<p:commandButton id="p_showBPMN" title="showBPMN" value="showBPMN" type="button" icon="ui-icon-extlink" />
     		<p:commandButton id="p_execute" title="execute" value="execute" action="#{wpsConnector.execute}" icon="ui-icon-arrowreturnthick-1-e" disabled="#{wpsConnector.connectionInvalid}" update=":form:message f_useFusionResult" />
     		<p:commandButton id="p_reset" title="reset" icon="ui-icon-trash" action="#{wpsConnector.reset}" update="p_wpsConnectors p_validation p_execute" onclick="f_reset();" style="margin-left:800px;" />
     	</h:panelGroup>
     	<p:overlayPanel id="p_bpmnOverlay" for="p_showBPMN" style="width:1000px;height:600px;overflow:auto;" hideEffect="fade" showEffect="fade">
	     	<p:commandButton value="Download" ajax="false" icon="ui-icon-arrowthick-1-s" style="margin-right:3px;">
	        	<p:fileDownload value="#{wpsConnector.bpmnXMLFile}" />
	    	</p:commandButton>
     		<h:outputText id="p_bpmnXML" value="#{wpsConnector.bpmnXML}" style="white-space:pre-wrap;" />
     	</p:overlayPanel>
     	<h:panelGroup layout="block" styleClass="content" >
     		<h:outputText id="p_validation" value="#{wpsConnector.validationMessage}" escape="false" styleClass="p_validationResult bad"/>
	     	<h:inputHidden id="p_connections" value="#{wpsConnector.connections}" />
	     	<p:remoteCommand name="p_connectionsChanged" process="p_connections" update="p_validation p_execute p_showBPMN p_bpmnXML p_bpmnOverlay"/>
     	</h:panelGroup>	
    </h:panelGrid>
        
	<div class="content section ui-state-hover">Compare Datasets</div>
	
	<h:panelGrid columns="2" styleClass="content" style="margin-bottom:0px;">
		<h:outputLabel for="f_useFusionResult" value="Enable feature relations " />
		<p:selectBooleanButton id="f_useFusionResult" onLabel="Yes" offLabel="No" style="width:50px" />
	</h:panelGrid>
	
	<h:panelGrid columns="1" style="padding-top:0px;width:100%;">
		<div>
			<div id="map_cr" class="map" style="width:48%;float:left;">
				<div id="map_cr_info" class="info" />
				<div id="map_cr_coord" class="coord" />
			</div>
			<div id="map_ct" class="map" style="width:48%;float:left;">
				<div id="map_ct_info" class="info" />
				<div id="map_ct_coord" class="coord" />	
			</div>
		</div>
		
	</h:panelGrid>
      
	</h:form>
</div>

<div id="mapMarker" style="display:none;">
	<div id="tMarker" class="marker" />
	<div id="rMarker" class="marker" />
</div>

<div id="footer" class="content ui-state-active">

</div>
    
<script src="http://openlayers.org/en/v3.4.0/build/ol.js" type="text/javascript"></script>
<!-- <script src="http://openlayers.org/en/v3.1.1/build/ol.js" type="text/javascript"></script> -->
<!-- <h:outputScript library="js/extern" name="ol-debug.js" /> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.3.3/proj4.js" type="text/javascript"></script>
<script src="http://epsg.io/31469.js" type="text/javascript"></script>
<h:outputScript library="js" name="ol-resource.js" />
<h:outputScript library="js" name="ol-common.js" />
<h:outputScript library="js" name="ol-stats.js" />
<h:outputScript library="js" name="ol-main.js" />
<h:outputScript library="js" name="common.js" />
<h:outputScript library="js" name="ld-relations.js" />
<h:outputScript library="js/extern" name="dom.jsPlumb-1.7.2.js" />
<h:outputScript library="js" name="plumb-main.js" />
	
</h:body>
</html>